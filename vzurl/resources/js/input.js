"use strict";!function(t,i,e){function s(t){var i=this;this.timer=!1,this.delay=500,this.regex=/^(https?|ftp):\/\/[^\s\/$.?#].[^\s]*$/i,this.$field=t,this.$wrapper=this.$field.parent(),this.$msg=this.$field.next(),this.$field.on("keyup paste",function(){i.checkField()}),this.checkField(!0)}s.prototype.checkField=function(i){this.timer&&clearTimeout(this.timer),""!==this.$field.val()&&(i?this.validate(this.$field):this.timer=setTimeout(t.proxy(this.validate,this),this.delay))},s.prototype.validate=function(){var t=this,e=this.$field.val();if(this.setStatus("checking"),"#"===e.charAt(0)||"?"===e.charAt(0))return void this.setStatus("valid");if(!e.match(this.regex))return void this.setStatus("invalid");var s=e.replace("http","ht^tp");i.postActionRequest("vzUrl/validation/check",{url:s}).done(function(i){i.original===t.$field.val()&&(i.http_code>=200&&i.http_code<400?i.original===i.final_url?t.setStatus("valid"):t.setStatus("redirect",i):t.setStatus("invalid"))}).fail(function(){t.setStatus("invalid")})},s.prototype.setStatus=function(e,s){var a=this;if(this.$field.prev().remove(),this.$wrapper.removeClass("empty checking invalid valid redirect"),this.$msg.empty(),"invalid"===e?(this.$msg.text(i.t("This URL appears to be invalid")),this.$wrapper.addClass("invalid")):"redirect"===e&&(this.$field.hasClass("follow-redirects")?(this.$wrapper.addClass("warning"),this.$msg.text(i.t("Redirects to")+" "+s.final_url+" "),t("<a/>",{text:i.t("Update"),click:function(t){a.$field.val(s.final_url),a.validate(a.$field),t.preventDefault()}}).appendTo(this.$msg)):e="valid"),this.$wrapper.addClass(e),"empty"!==e&&"checking"!==e){var l=t("<a/>",{href:this.$field.val(),"class":"vzurl-visit",target:"_blank","data-icon":"world",title:i.t("Visit URL")+": "+this.$field.val()});this.$field.before(l)}},e.VzUrl=s}(window.jQuery,window.Craft,window);